<% if user_signed_in? %>

  <% if @current_user.username.downcase == "nick" %>
    <% @image = "avatar_nick.jpeg"%>
    <% @role = "Pokemon Master" %>
    <% @workplace = "Nintendo" %>
    <% @quote = "Taming Pokemon since 1994" %>
    <% @author = "Self" %>
  <% elsif @current_user.username.downcase == "sjacob" %>
    <% @image = "sjacob_3.jpg"%>
    <% @role = "Product Development" %>
    <% @workplace = "Ice Cream R Us" %>
    <% @quote = "Tomorrow we can eat broccoli, but today is for ice cream." %>
    <% @author = "Malory Hobson" %>
  <% end %>


  <% current_user.projects.each do |project| %>
    <% project.surveys.each do |survey| %>
        <% if survey.featured %>
          <% @featured_survey = survey %>
        <% end %>
    <% end %>
  <% end %>

  <div class="container mt-5 whole-card">
      <div class="row align-items-center justify-content-center text-center">
        <div class="col-12 col-lg-4 col-xl-4 profile p-5" >
          <div class>
            <%= image_tag "#{@image}", alt: "alttext", class: "profile-pic", style: "width:150px; height:150px" %>
            <h2><%= current_user.first_name %> <%= current_user.last_name %></h2>
            <h6 class="mb-0"><%= @role %></h6>
            <h6>at <span style="font-style: italic"><%= @workplace %></span></h6>

              <div class="social-media">
                <i class="fab fa-facebook"></i>
                <i class="fab fa-twitter-square"></i>
                <i class="fab fa-researchgate"></i>
              </div>

              <p class="m-0"><%= @quote %></p>
              <p>- <span style="font-style: italic"><%= @author %></span></p>
            </div>

          </div>

          <div class="col-12 col-lg-8 col-xl-8 p-3">

            <% if !@featured_survey %>
              <h4>You have not selected a survey to be sent out. Please select a survey from the list below</h4>
                <%= simple_form_for(:survey, url: feature_survey_path) do |f| %>
                  <%= f.input :featured_survey, collection: @all_surveys %>
                  <%= f.button :submit, class: "button outline-button"  %>
                <% end %>

            <% else %>

            <% @typeform_id_survey = @featured_survey.typeform_id %>

              <h2><span style= "text-decoration: underline;"><%= @featured_survey.name %></span></h2>
              <p style="font-size: 18px";><%= @featured_survey.welcome_messages.last.description%></p>
              <button class="button outline-button py-2 px-3" id="bt-popup-user">Preview Survey</button>
<!--               <button id="share-survey" class="finish-editing m-2 p-2">Share Survey</button>
 -->
              <div class="col-12 col-lg-6 col-xl-8 mt-4 justify-content-center">
                <p style="font-size: 14px;">You can change the survey you want to send by updating your choice from the list below </p>

                <div class="d-flex justify-content-center">
                <%= simple_form_for(:survey, url: feature_survey_path) do |f| %>
                  <%= f.input :featured_survey, collection: @all_surveys %>
                  <%= f.button :submit, class: "button outline-button"  %>
                <% end %>
                </div>
              </div>
            <% end %>
          </div>
    </div>
  </div>




<% else %>
  <% @typeform_id_survey = @user_survey.typeform_id  %>

    <% if @user.username.downcase == "nick" %>
    <% @image = "avatar_nick.jpeg"%>
    <% @role = "Pokemon Master" %>
    <% @workplace = "Nintendo" %>
    <% @quote = "Taming Pokemon since 1994" %>
    <% @author = "Self" %>
  <% elsif @user.username.downcase == "sjacob" %>
    <% @image = "sjacob_3.jpg"%>
    <% @role = "Product Development" %>
    <% @workplace = "Ice Cream R Us" %>
    <% @quote = "Tomorrow we can eat broccoli, but today is for ice cream." %>
    <% @author = "Malory Hobson" %>
  <% end %>

  <div class="container mt-4 whole-card">
      <div class="row align-items-center justify-content-center text-center">
          <div class="col-12 col-lg-8 col-xl-8 p-3">
              <h3 class="p-2">Hello there!</h3>
            <div style="font-style: italic;">
              <p class="mb-0 mt-1" style="font-size: 14px;">Thank you for visiting my survey on <span><a href="https://www.dcme.today" style="color: #fccd08;">dcme.today!</a></span></p>
              <p class="mb-0" style="font-size: 14px;">You will find the details of my survey below. If you have any quesitons, please reach out to me at <span><a href="#"><%= @user.email %></a></span></p>
            </div>
            <div class="p-3">
              <h2 class="mt-3"><span style= "text-decoration: underline;"><%= @user_survey.name %></span></h2>
              <p style="font-size: 18px";><%= @user_survey.welcome_messages.last.description%></p>
              <button class="button outline-button py-2 px-3" id="bt-popup-user" style="background: white;">Take Survey</button>
              <!-- <button id="share-survey" class="finish-editing m-2 p-2">Share Survey</button> -->
            </div>
          </div>

          <div class="col-12 col-lg-4 col-xl-4 profile p-5" >
          <div class>

            <%= image_tag "#{@image}", alt: "alttext", class: "profile-pic" %>
            <h2><%= @user.first_name %> <%= @user.last_name %></h2>
            <h6 class="mb-0"><%= @role %></h6>
            <h6>at <span style="font-style: italic"><%= @workplace %></span></h6>

              <div class="social-media">
                <i class="fab fa-facebook"></i>
                <i class="fab fa-twitter-square"></i>
                <i class="fab fa-researchgate"></i>
              </div>

              <p class="m-0 pt-1"><%= @quote %></p>
              <p>- <span style="font-style: italic"><%= @author %></span></p>
            </div>

          </div>
    </div>
  </div>







<% end %>

<script src="https://embed.typeform.com/embed.js" type="text/javascript"></script>
    <script type="text/javascript">

      let popup1;
      window.addEventListener('DOMContentLoaded', function () {

          popup1 = window.typeformEmbed.makePopup("https://dcme.typeform.com/to/<%= @typeform_id_survey%>", {
            hideHeaders: true,
            hideFooter: true
          });
        })

        document.getElementById('bt-popup-user').addEventListener('click', function () {
          popup1.open();
        });
    </script>

